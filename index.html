<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel Administrativo — Fábrica Super Odds</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --yellow: #f6d44b;
      --gold: #f4c542;
      --green: #2ecc71;
      --red: #e74c3c;
      --bg: #fffbea;
      --text: #333;
    }
    * {
      font-family: "Poppins", sans-serif;
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    header {
      background: var(--gold);
      color: #fff;
      text-align: center;
      padding: 20px;
      font-size: 1.3rem;
      font-weight: 600;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      background: #fff7d1;
      padding: 15px 0;
      border-bottom: 1px solid #f0e6a9;
    }
    .stat {
      text-align: center;
    }
    .stat h3 {
      margin: 5px 0 0;
      font-size: 1.2rem;
    }
    .filters {
      display: flex;
      justify-content: space-around;
      margin: 10px;
      gap: 10px;
    }
    .filters button {
      flex: 1;
      border: none;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      background: var(--yellow);
      font-weight: 600;
      transition: 0.3s;
    }
    .filters button:hover {
      background: var(--gold);
      color: white;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead {
      background: var(--yellow);
    }
    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #f5f5f5;
      font-size: 0.9rem;
    }
    .actions button {
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      margin: 2px;
      cursor: pointer;
      color: white;
      font-size: 0.8rem;
      transition: 0.3s;
    }
    .btn-green { background: var(--green); }
    .btn-red { background: var(--red); }
    .btn-yellow { background: #f1c40f; color: #333; }
    .btn-green:hover { opacity: 0.8; }
    .btn-red:hover { opacity: 0.8; }
    .btn-yellow:hover { opacity: 0.8; }
    .empty {
      text-align: center;
      padding: 20px;
      color: #777;
    }
    @media (max-width: 500px) {
      th:nth-child(2), td:nth-child(2) { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>Super Odds — Painel Admin</header>

    <div class="stats">
      <div class="stat"><strong>Lib.</strong><h3 id="count-liberados">0</h3></div>
      <div class="stat"><strong>Blq.</strong><h3 id="count-bloqueados">0</h3></div>
      <div class="stat"><strong>Pend.</strong><h3 id="count-pendentes">0</h3></div>
    </div>

    <div class="filters">
      <button onclick="filtrar('todos')">Todos</button>
      <button onclick="filtrar('liberados')">Liberados</button>
      <button onclick="filtrar('bloqueados')">Bloqueados</button>
      <button onclick="filtrar('pendentes')">Pendentes</button>
    </div>

    <table>
      <thead>
        <tr><th>Email</th><th>Status</th><th>Ações</th></tr>
      </thead>
      <tbody id="user-table">
        <tr><td colspan="3" class="empty">Carregando usuários...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const API = "https://backendfabricasuperodds.onrender.com/api/users";
    let usuarios = [];

    async function carregarUsuarios() {
      try {
        const res = await fetch(API);
        const data = await res.json();
        if (!data.success) throw new Error("Erro ao carregar usuários");
        usuarios = data.users;
        atualizarContadores();
        renderizarTabela();
      } catch (err) {
        console.error(err);
        document.getElementById("user-table").innerHTML =
          '<tr><td colspan="3" class="empty">Erro ao carregar usuários.</td></tr>';
      }
    }

    function atualizarContadores() {
      document.getElementById("count-liberados").textContent =
        usuarios.filter(u => u.enabled).length;
      document.getElementById("count-bloqueados").textContent =
        usuarios.filter(u => !u.enabled && u.email.endsWith("block")).length;
      document.getElementById("count-pendentes").textContent =
        usuarios.filter(u => !u.enabled && !u.email.endsWith("block")).length;
    }

    function renderizarTabela(filtro = "todos") {
      const tbody = document.getElementById("user-table");
      tbody.innerHTML = "";

      let lista = usuarios;
      if (filtro === "liberados") lista = usuarios.filter(u => u.enabled);
      else if (filtro === "pendentes") lista = usuarios.filter(u => !u.enabled);
      else if (filtro === "bloqueados") lista = usuarios.filter(u => u.email.endsWith("block"));

      if (lista.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty">Nenhum usuário encontrado.</td></tr>';
        return;
      }

      lista.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.email}</td>
          <td>${u.enabled ? "Liberado" : "Pendente"}</td>
          <td class="actions">
            <button class="btn-green" onclick="atualizarUsuario('${u.email}', true)">Liberar</button>
            <button class="btn-yellow" onclick="atualizarUsuario('${u.email}', false)">Bloquear</button>
            <button class="btn-red" onclick="excluirUsuario('${u.email}')">Excluir</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    async function atualizarUsuario(email, enabled) {
      if (!confirm(`Deseja realmente ${enabled ? "liberar" : "bloquear"} este usuário?`)) return;

      try {
        const res = await fetch(`${API}/${email}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ enabled }),
        });
        if (!res.ok) throw new Error(`Erro ${res.status}`);
        alert(`Usuário ${enabled ? "liberado" : "bloqueado"} com sucesso!`);
        carregarUsuarios();
      } catch (err) {
        console.error(err);
        alert("Erro ao atualizar usuário.");
      }
    }

    async function excluirUsuario(email) {
      if (!confirm("Tem certeza que deseja excluir este usuário?")) return;

      try {
        const res = await fetch(`${API}/${email}`, { method: "DELETE" });
        if (!res.ok) throw new Error(`Erro ${res.status}`);
        alert("Usuário excluído com sucesso!");
        carregarUsuarios();
      } catch (err) {
        console.error(err);
        alert("Erro ao excluir usuário.");
      }
    }

    function filtrar(tipo) {
      renderizarTabela(tipo);
    }

    carregarUsuarios();
  </script>
</body>
</html>
